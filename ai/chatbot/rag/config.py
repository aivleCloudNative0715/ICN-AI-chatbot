import re
from openai import OpenAI
import os # API í‚¤ë¥¼ í™˜ê²½ ë³€ìˆ˜ì—ì„œ ë¡œë“œí•˜ê¸° ìœ„í•´ í•„ìš”
from dotenv import load_dotenv # dotenv ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„í¬íŠ¸
from pathlib import Path # Path ê°ì²´ ì„í¬íŠ¸
from pymongo import MongoClient
from chatbot.rag.llm_tools import _format_and_style_with_llm

env_path = Path(__file__).resolve().parents[2] / ".env"
load_dotenv(dotenv_path=env_path, override=True) # override=True ì¶”ê°€ ê¶Œì¥

api_key = os.getenv("OPENAI_API_KEY")
client = OpenAI(api_key=api_key)

# MongoDB í´ë¼ì´ì–¸íŠ¸
try:
    mongo_uri = os.getenv("MONGO_URI")
    mongo_db_name = os.getenv("MONGO_DB_NAME")
    if not mongo_uri or not mongo_db_name:
        raise ValueError("MongoDB í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
    mongo_client = MongoClient(mongo_uri)
    mongo_client.admin.command('ping')
    print("MongoDBì— ì„±ê³µì ìœ¼ë¡œ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤!")
except Exception as e:
    print(f"MongoDB ì—°ê²° ì˜¤ë¥˜: {e}")
    mongo_client = None

# OpenAI í´ë¼ì´ì–¸íŠ¸
openai_api_key = os.getenv("OPENAI_API_KEY")
if not openai_api_key:
    raise ValueError("OPENAI_API_KEY í™˜ê²½ ë³€ìˆ˜ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
openai_client = OpenAI(api_key=openai_api_key)

# ë‹¤ë¥¸ íŒŒì¼ì—ì„œ ë¶ˆëŸ¬ì˜¬ ë³€ìˆ˜ë“¤
db_client = mongo_client
client = openai_client
db_name = mongo_db_name


# ê° ì˜ë„(ë˜ëŠ” í•¸ë“¤ëŸ¬)ë³„ RAG ê²€ìƒ‰ ì„¤ì •ì„ ì •ì˜í•©ë‹ˆë‹¤.
# ì´ ì„¤ì •ì€ ê° í•¸ë“¤ëŸ¬ì—ì„œ ì–´ë–¤ MongoDB ì»¬ë ‰ì…˜ì„ ì‚¬ìš©í•´ì•¼ í•˜ëŠ”ì§€ ì•Œë ¤ì¤ë‹ˆë‹¤.
RAG_SEARCH_CONFIG = {
    "airline_info_query": {
        "collection_name": "AirlineVector",
        "vector_index_name": "airline_vector_index",
        "description": "í•­ê³µì‚¬ ì •ë³´ (ê³ ê°ì„¼í„°)"
    },
    "parking_fee_info": {
        "collection_name": "ParkingLotPolicyVector",
        "vector_index_name": "parkingLotPolicy_vector_index",
        "description": "ì£¼ì°¨ ìš”ê¸ˆ ë° í• ì¸ ì •ì±…"
    },
    "parking_walk_time_info": {
        "collection_name": "ConnectionTimeVector",
        "vector_index_name": "connectionTime_vector_index",
        "description": "ì£¼ì°¨ì¥-í„°ë¯¸ë„ ë„ë³´ ì‹œê°„ ì •ë³´"
    },
    "parking_location_recommendation": {
        "collection_name": "ParkingLotVector",
        "vector_index_name": "parkingLot_vector_index",
        "description": "ì£¼ì°¨ì¥ ìœ„ì¹˜ ì¶”ì²œ"
    },
    "immigration_policy": {
        "collection_name": "AirportPolicyVector",
        "vector_index_name": "airportPolicy_vector_index",
        "description": "ì…ì¶œêµ­ ì ˆì°¨ ë° ì •ì±…",
    },
    "baggage_rule_query": {
        "collection_name": "AirportPolicyVector",
        "vector_index_name": "airportPolicy_vector_index",
        "description": "ìˆ˜í•˜ë¬¼ ê·œì • (ì œí•œ ë¬¼í’ˆ ë“±)",
    },
    "transfer_info": {
        "collection_name": "AirportPolicyVector",
        "vector_index_name": "airportPolicy_vector_index",
        "description": "í™˜ìŠ¹ ì¼ë°˜ ì •ë³´"
    },
    "transfer_route_guide": {
        "main_collection": {
            "name": "TransitPathVector",
            "vector_index": "transitPath_vector_index"
        },
        "additional_collections": [ # ì¶”ê°€ ì»¬ë ‰ì…˜ ë¦¬ìŠ¤íŠ¸
            {
                "name": "ConnectionTimeVector",
                "vector_index": "connectionTime_vector_index"
            }
        ],
        "description": "í™˜ìŠ¹ ê²½ë¡œ ë° ìµœì € í™˜ìŠ¹ ì‹œê°„",
        "query_filter": None # ê³µí†µ í•„í„°ë§ì´ ìˆë‹¤ë©´ ì—¬ê¸°ì— ì¶”ê°€
    },
    "facility_guide": {
        "collection_name": "AirportFacilityVector",
        "vector_index_name": "airportFacility_vector_index",
        "description": "ê³µí•­ ì‹œì„¤ ë° ì…ì  ì—…ì²´ ì •ë³´"
    },
    "airport_info": {
        "collection_name": "AirportVector",
        "vector_index_name": "airport_vector_index",
        "description": "ê³µí•­ ì½”ë“œ, ì´ë¦„, ìœ„ì¹˜ ë“± ì¼ë°˜ ê³µí•­ ì •ë³´"
    }
    # ì—¬ê¸°ì— ë‹¤ë¥¸ RAG ì˜ë„ì— ëŒ€í•œ ì„¤ì •ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
}

# LLMì„ ìœ„í•œ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì„ ì˜ë„ë³„ë¡œ ì •ì˜í•©ë‹ˆë‹¤.
# ê° í…œí”Œë¦¿ì€ {user_query}ì™€ {retrieved_context} í”Œë ˆì´ìŠ¤í™€ë”ë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.
LLM_PROMPT_TEMPLATES = {
    "airline_info_query": """
    ë‹¹ì‹ ì€ ì¸ì²œêµ­ì œê³µí•­ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ì±—ë´‡ì…ë‹ˆë‹¤. ë‹¤ìŒ ê²€ìƒ‰ëœ í•­ê³µì‚¬ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ì ì§ˆë¬¸ì— ë‹µë³€í•´ì£¼ì„¸ìš”.
    
    ë‹¤ìŒ ì§€ì¹¨ì„ ë°˜ë“œì‹œ ë”°ë¥´ì„¸ìš”:
    1.  ì£¼ì–´ì§„ ì •ë³´ ë‚´ì—ì„œë§Œ ë‹µë³€í•˜ì„¸ìš”.
    2.  ê²€ìƒ‰ëœ ì •ë³´ì— ì§ˆë¬¸ì— ëŒ€í•œ ë‚´ìš©ì´ ì—†ì„ ê²½ìš°, ì§ˆë¬¸ ë‚´ìš©ì´ ì—†ê±°ë‚˜ ë‹µë³€í•  ìˆ˜ ì—†ìŒì„ ëª…í™•í•˜ê²Œ ì•Œë¦¬ê³ , ì±—ë´‡ì´ ì œê³µí•  ìˆ˜ ìˆëŠ” ì •ë³´ì˜ í•œê³„ë¥¼ ê°„ì ‘ì ìœ¼ë¡œ ì„¤ëª…í•´ ì£¼ì„¸ìš”.** (ì˜ˆ: "í•´ë‹¹ ë‚´ìš©ì„ ì œê³µí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", "í˜„ì¬ ì €ì˜ ì§€ì‹ ë²”ìœ„ ë‚´ì—ì„œëŠ” ì´ë¯¸ì§€ë¥¼ ì§ì ‘ ë³´ì—¬ë“œë¦¬ê±°ë‚˜ ì´ë¯¸ì§€ ê´€ë ¨ ì •ë³´ë¥¼ ì œê³µí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
    3.  'ì „ì²´ ëª©ë¡'ê³¼ ê°™ì´ ê²€ìƒ‰ëœ ì •ë³´ì˜ ë²”ìœ„ë¥¼ ë„˜ì–´ì„œëŠ” ì§ˆë¬¸ì¼ ê²½ìš°, ê²€ìƒ‰ëœ ë‚´ìš©ì˜ ì¼ë¶€ì„ì„ ëª…í™•íˆ ì•Œë¦¬ê³ , ì‚¬ìš©ìê°€ ë” êµ¬ì²´ì ìœ¼ë¡œ ì§ˆë¬¸í•´ì•¼ í•¨ì„ ìœ ë„í•˜ì„¸ìš”. (ì˜ˆ: "ê²€ìƒ‰ëœ ì •ë³´ëŠ” ì „ì²´ ëª©ë¡ì˜ ì¼ë¶€ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŠ¹ì • í•­ê³µì‚¬ì— ëŒ€í•´ ë¬¸ì˜í•˜ì‹œë©´ ê´€ë ¨ ì •ë³´ë¥¼ ë” ì •í™•íˆ ì°¾ì•„ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.")
    4.  ë‹µë³€ì€ ëª…í™•í•˜ê³  ê°„ê²°í•˜ê²Œ ì‘ì„±í•˜ì„¸ìš”.
    ì‚¬ìš©ì ì§ˆë¬¸: {user_query}
    ê²€ìƒ‰ëœ í•­ê³µì‚¬ ì •ë³´: {retrieved_context}

    ë‹µë³€:""",

    "parking_fee_info": """ë‹¹ì‹ ì€ ì¸ì²œêµ­ì œê³µí•­ ì±—ë´‡ì…ë‹ˆë‹¤. ë‹¤ìŒ ì£¼ì°¨ ìš”ê¸ˆ ë° í• ì¸ ì •ì±… ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ì ì§ˆë¬¸ì— ê°„ê²°í•˜ê³  ì •í™•í•˜ê²Œ ë‹µë³€í•´ì£¼ì„¸ìš”.

    ë‹¤ìŒ ì§€ì¹¨ì„ ë°˜ë“œì‹œ ë”°ë¥´ì„¸ìš”:
    1. ì œê³µëœ 'ê²€ìƒ‰ëœ ì£¼ì°¨ ìš”ê¸ˆ ë° ì •ì±…' ì •ë³´ ë‚´ì—ì„œë§Œ ë‹µë³€í•˜ì„¸ìš”.
    2. ê¸ˆì•¡, ì‹œê°„, í• ì¸ìœ¨ ë“± êµ¬ì²´ì ì¸ ìˆ«ìëŠ” ê²€ìƒ‰ëœ ì •ë³´ì™€ ì •í™•íˆ ì¼ì¹˜í•˜ê²Œ ì‚¬ìš©í•˜ì„¸ìš”.
    3. **ìš”ê¸ˆ ê³„ì‚°ì´ í•„ìš”í•  ê²½ìš°, ë‹¤ìŒì˜ ì—„ê²©í•œ ì ˆì°¨ë¥¼ ë°˜ë“œì‹œ ë”°ë¥´ì„¸ìš”:**
        a. ì‚¬ìš©ì ì§ˆë¬¸ì˜ ì´ ì£¼ì°¨ ì‹œê°„ì„ **ë¶„(minute) ë‹¨ìœ„**ë¡œ ì •í™•íˆ íŒŒì•…í•˜ì„¸ìš”.
        b. ê²€ìƒ‰ëœ ì •ë³´ì—ì„œ 'ìµœì´ˆ ìš”ê¸ˆ'ì— í•´ë‹¹í•˜ëŠ” ì‹œê°„ê³¼ ê¸ˆì•¡ì„ ë¨¼ì € ë¶„ë¦¬í•˜ì„¸ìš”.
        c. ì´ ì‹œê°„ì—ì„œ ìµœì´ˆ ìš”ê¸ˆ ì‹œê°„ì„ ëº€ **'ë‚¨ì€ ì‹œê°„'**ì„ ê³„ì‚°í•˜ì„¸ìš”.
        d. ê²€ìƒ‰ëœ ì •ë³´ì˜ 'ì¶”ê°€ ìš”ê¸ˆ' ë‹¨ìœ„ ì‹œê°„(ì˜ˆ: 15ë¶„)ì„ ì‚¬ìš©í•˜ì—¬ ë‚¨ì€ ì‹œê°„ì´ ëª‡ ë²ˆì˜ ì¶”ê°€ ìš”ê¸ˆì— í•´ë‹¹í•˜ëŠ”ì§€ **ì •í™•í•˜ê²Œ ê³„ì‚°í•˜ì„¸ìš”.**
        e. ìµœì´ˆ ìš”ê¸ˆê³¼ ê³„ì‚°ëœ ì¶”ê°€ ìš”ê¸ˆì„ **í•©ì‚°**í•˜ì—¬ ìµœì¢… ê¸ˆì•¡ì„ ë„ì¶œí•˜ì„¸ìš”.
    4. ë§Œì•½ ê²€ìƒ‰ëœ ì •ë³´ë§Œìœ¼ë¡œëŠ” ìš”ê¸ˆ ê³„ì‚°ì´ ë¶ˆê°€ëŠ¥í•˜ê±°ë‚˜, ì‚¬ìš©ì ì§ˆë¬¸ì— ëŒ€í•œ ë‚´ìš©ì´ ì „í˜€ ì—†ì„ ê²½ìš°ì—ë§Œ ë‹µë³€í•  ìˆ˜ ì—†ìŒì„ ëª…í™•íˆ ì•Œë¦¬ì„¸ìš”. (ì˜ˆ: "ì œê°€ ë³´ìœ í•œ ì •ë³´ë¡œëŠ” í•´ë‹¹ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì¸ì²œêµ­ì œê³µí•­ ê³µì‹ ì›¹ì‚¬ì´íŠ¸ì—ì„œ ìµœì‹  ì •ë³´ë¥¼ í™•ì¸í•˜ì‹œê±°ë‚˜, ë‹¤ë¥¸ ì§ˆë¬¸ì„ í•´ì£¼ì„¸ìš”.")
    5. ì‚¬ìš©ìì˜ ì§ˆë¬¸ì´ íŠ¹ì • ì£¼ì°¨ì¥(ì˜ˆ: ë‹¨ê¸°, ì¥ê¸°, ì˜ˆì•½ ì£¼ì°¨ì¥ ë“±)ì— ëŒ€í•œ ê²ƒì´ë¼ë©´, í•´ë‹¹ ì£¼ì°¨ì¥ì˜ ì •ë³´ë§Œì„ ë°”íƒ•ìœ¼ë¡œ ë‹µë³€í•˜ê³  ë‹¤ë¥¸ ì£¼ì°¨ì¥ ì •ë³´ë¥¼ í˜¼ìš©í•˜ì§€ ë§ˆì„¸ìš”.

    ì‚¬ìš©ì ì§ˆë¬¸: {user_query}
    ê²€ìƒ‰ëœ ì£¼ì°¨ ìš”ê¸ˆ ë° ì •ì±…: {retrieved_context}

    ë‹µë³€:""",
        
    "parking_walk_time_info": """ë‹¹ì‹ ì€ ì¸ì²œêµ­ì œê³µí•­ ì±—ë´‡ì…ë‹ˆë‹¤. ë‹¤ìŒ ì£¼ì°¨ì¥-í„°ë¯¸ë„ ë„ë³´ ì‹œê°„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ì ì§ˆë¬¸ì— ë‹µë³€í•´ì£¼ì„¸ìš”.
    
    ë‹¤ìŒ ì§€ì¹¨ì„ ë°˜ë“œì‹œ ë”°ë¥´ì„¸ìš”:
    1. ì£¼ì–´ì§„ 'ê²€ìƒ‰ëœ ë„ë³´ ì‹œê°„ ì •ë³´' ë‚´ì—ì„œë§Œ ë‹µë³€í•˜ì„¸ìš”.
    2. ë„ë³´ ì‹œê°„ì„ ì•ˆë‚´í•  ë•ŒëŠ” ì–´ë–¤ ì£¼ì°¨ì¥ê³¼ ì–´ë–¤ í„°ë¯¸ë„(ì œ1í„°ë¯¸ë„, ì œ2í„°ë¯¸ë„ ë“±)ì„ ê¸°ì¤€ìœ¼ë¡œ í•˜ëŠ”ì§€ ëª…í™•í•˜ê²Œ ì–¸ê¸‰í•´ì£¼ì„¸ìš”. (ì˜ˆ: "ì œ1í„°ë¯¸ë„ ì¥ê¸° ì£¼ì°¨ì¥ì—ì„œ ë„ë³´ë¡œ ì•½ 5ë¶„ ì†Œìš”ë©ë‹ˆë‹¤.")
    3. ì§ˆë¬¸ì´ ë¶ˆëª…í™•í•  ë•ŒëŠ” ë” ìì„¸í•œ ìœ„ì¹˜ë¥¼ ì•Œë ¤ì£¼ë©´ ë” ì •í™•í•œ ì •ë³´ë¥¼ ì°¾ì•„ë“œë¦´ ìˆ˜ ìˆë‹¤ê³  ë‹µë³€í•˜ì„¸ìš”.
    4. ì• ë§¤ëª¨í˜¸í•˜ê±°ë‚˜ ë¶ˆí•„ìš”í•œ ì •ë³´ëŠ” ì¶”ê°€í•˜ì§€ ë§ˆì„¸ìš”.
    5. ë‹µë³€ì€ ê°„ê²°í•˜ê³  ì •í™•í•˜ê²Œ ì‘ì„±í•˜ë©°, ëŒ€ëµì ì¸ ì‹œê°„ì„ì„ ëª…ì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì˜ˆ: "ì•½ ~ë¶„", "~ë¶„ ê°€ëŸ‰")
    
    ì‚¬ìš©ì ì§ˆë¬¸: {user_query}
    ê²€ìƒ‰ëœ ë„ë³´ ì‹œê°„ ì •ë³´: {retrieved_context}

    ë‹µë³€:""",

    "parking_location_recommendation": """ë‹¹ì‹ ì€ ì¸ì²œêµ­ì œê³µí•­ ì±—ë´‡ì…ë‹ˆë‹¤. ë‹¤ìŒ ê²€ìƒ‰ëœ ì£¼ì°¨ì¥ ìœ„ì¹˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ìì—ê²Œ ì í•©í•œ ì£¼ì°¨ì¥ì„ ì¶”ì²œí•˜ê³  ìƒì„¸íˆ ì•ˆë‚´í•´ì£¼ì„¸ìš”.
    
    ë‹¤ìŒ ì§€ì¹¨ì„ ë°˜ë“œì‹œ ë”°ë¥´ì„¸ìš”:
    1.  ì œê³µëœ 'ê²€ìƒ‰ëœ ì£¼ì°¨ì¥ ìœ„ì¹˜ ì •ë³´' ë‚´ì—ì„œë§Œ ë‹µë³€í•˜ê³  ì¶”ì²œí•˜ì„¸ìš”.
    2.  ì‚¬ìš©ìì˜ ì§ˆë¬¸ (ì˜ˆ: "ê°€ê¹Œìš´", "ë„“ì€", "í„°ë¯¸ë„ë³„" ë“±)ì— ê°€ì¥ ë¶€í•©í•˜ëŠ” ì£¼ì°¨ì¥ì„ ì¶”ì²œí•˜ê³ , ê·¸ ì´ìœ ë¥¼ ê°„ëµí•˜ê²Œ ì„¤ëª…í•´ì£¼ì„¸ìš”.
    3.  ê° ì¶”ì²œ ì£¼ì°¨ì¥ì˜ ì£¼ìš” íŠ¹ì§•(ì˜ˆ: ë‹¨ê¸°/ì¥ê¸° ì—¬ë¶€, í„°ë¯¸ë„ê³¼ì˜ ê±°ë¦¬, ì£¼ìš” ì‹œì„¤ ê·¼ì ‘ì„± ë“±)ì„ ê°„ê²°í•˜ê²Œ ì–¸ê¸‰í•´ì£¼ì„¸ìš”.
    4.  ê²€ìƒ‰ëœ ì •ë³´ë§Œìœ¼ë¡œëŠ” ì‚¬ìš©ìì—ê²Œ ì í•©í•œ ì£¼ì°¨ì¥ì„ ì¶”ì²œí•˜ê¸° ì–´ë µê±°ë‚˜, ì§ˆë¬¸ì— ëŒ€í•œ ì •ë³´ê°€ ì—†ì„ ê²½ìš°, ë‹µë³€í•  ìˆ˜ ì—†ìŒì„ ëª…í™•íˆ ì•Œë¦¬ê³  ì¶”ê°€ ì •ë³´ë¥¼ ìš”ì²­í•˜ì„¸ìš”. (ì˜ˆ: "ì–´ë–¤ ì¢…ë¥˜ì˜ ì£¼ì°¨ì¥ì„ ì°¾ìœ¼ì‹œëŠ”ì§€ (ë‹¨ê¸°/ì¥ê¸°, íŠ¹ì • í„°ë¯¸ë„ ê·¼ì²˜ ë“±) ì¢€ ë” êµ¬ì²´ì ìœ¼ë¡œ ì•Œë ¤ì£¼ì‹œë©´ ì í•©í•œ ì£¼ì°¨ì¥ì„ ì¶”ì²œí•´ ë“œë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.", "ì œê³µëœ ì •ë³´ë¡œëŠ” í•´ë‹¹ ë‚´ìš©ì„ ì¶”ì²œí•˜ê¸° ì–´ë µìŠµë‹ˆë‹¤.")
    5.  ì£¼ì°¨ ìš”ê¸ˆ ì •ë³´ëŠ” ì§ì ‘ ì–¸ê¸‰í•˜ì§€ ë§ˆì„¸ìš”. (ìš”ê¸ˆì€ 'parking_fee_info' ì˜ë„ì—ì„œ ë‹¤ë£¨ë„ë¡ í•©ë‹ˆë‹¤.)
    6.  ì¶”ì²œ ì‹œ ì£¼ì°¨ì¥ ê°„ì˜ ì¥ë‹¨ì ì„ ì§ì ‘ì ìœ¼ë¡œ ë¹„êµí•˜ì—¬ ìš°ìœ„ë¥¼ ê°€ë¥´ê¸°ë³´ë‹¤ëŠ”, ê° ì£¼ì°¨ì¥ì˜ íŠ¹ì§•ì„ ë‚˜ì—´í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì •ë³´ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”.
    7.  ë§ˆì§€ë§‰ì— "ì£¼ì°¨ ê³µê°„ í˜„í™©ì€ ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€ë™ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ, ê³µí•­ ë„ì°© ì „ì— ì¸ì²œêµ­ì œê³µí•­ ê³µì‹ ì›¹ì‚¬ì´íŠ¸ì—ì„œ ì‹¤ì‹œê°„ ì£¼ì°¨ ì •ë³´ë¥¼ í™•ì¸í•˜ì‹œëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤." ì™€ ê°™ì€ ë¬¸êµ¬ë¥¼ ë°˜ë“œì‹œ ì¶”ê°€í•˜ì—¬ ìµœì¢… í™•ì¸ì€ ê³µì‹ ì¶œì²˜ë¥¼ í†µí•´ í•  ê²ƒì„ ì•ˆë‚´í•´ì£¼ì„¸ìš”.
    
    ì‚¬ìš©ì ì§ˆë¬¸: {user_query}
    ê²€ìƒ‰ëœ ì£¼ì°¨ì¥ ìœ„ì¹˜ ì •ë³´: {retrieved_context}

    ë‹µë³€:""",
        
    "immigration_policy_info": """ë‹¹ì‹ ì€ ì¸ì²œêµ­ì œê³µí•­ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ì±—ë´‡ì…ë‹ˆë‹¤. ë‹¤ìŒ ì…ì¶œêµ­ ì ˆì°¨ ë° ì •ì±… ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ì ì§ˆë¬¸ì— ë‹¨ê³„ë³„ë¡œ ìƒì„¸íˆ ë‹µë³€í•´ì£¼ì„¸ìš”.
    
    ë‹¤ìŒ ì§€ì¹¨ì„ ë°˜ë“œì‹œ ë”°ë¥´ì„¸ìš”:
    1.  ì œê³µëœ 'ê²€ìƒ‰ëœ ì…ì¶œêµ­ ì •ì±…' ì •ë³´ ë‚´ì—ì„œë§Œ ë‹µë³€í•˜ì„¸ìš”. ì—†ëŠ” ì •ë³´ëŠ” ì ˆëŒ€ë¡œ ì¶”ë¡ í•˜ì—¬ ë‹µë³€í•˜ì§€ ë§ˆì„¸ìš”.
    2.  ë‹µë³€ì€ ëª…í™•í•˜ê³  ê°„ê²°í•˜ë©°, ì‚¬ìš©ì ì§ˆë¬¸ì— í•´ë‹¹í•˜ëŠ” ë‚´ìš©ì— ì§‘ì¤‘í•˜ì„¸ìš”.
    3.  ì…ì¶œêµ­ ì ˆì°¨ëŠ” ê°€ëŠ¥í•œ í•œ ë‹¨ê³„ë³„ë¡œ ë‚˜ëˆ„ì–´ ì„¤ëª…í•˜ì—¬ ì‚¬ìš©ìê°€ ì´í•´í•˜ê¸° ì‰½ë„ë¡ í•´ì£¼ì„¸ìš”.
    4.  ê²€ìƒ‰ëœ ì •ë³´ì— ì‚¬ìš©ì ì§ˆë¬¸ì— ëŒ€í•œ ë‚´ìš©ì´ ì—†ê±°ë‚˜, ë¶ˆì¶©ë¶„í•  ê²½ìš°, ë‹µë³€í•  ìˆ˜ ì—†ìŒì„ ëª…í™•íˆ ì•Œë¦¬ì„¸ìš”. (ì˜ˆ: "ì œê°€ ê°€ì§„ ì •ë³´ë¡œëŠ” í•´ë‹¹ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
    5.  íŠ¹íˆ ë‹¤ìŒê³¼ ê°™ì€ ì •ë³´ì— ëŒ€í•´ ì§ˆë¬¸ì´ ìˆì„ ê²½ìš°, ê²€ìƒ‰ëœ ì •ë³´ì— í•´ë‹¹ ë‚´ìš©ì´ ì—†ë”ë¼ë„ ë°˜ë“œì‹œ ì¶”ê°€ì ì¸ ì•ˆë‚´ ë¬¸êµ¬ë¥¼ í¬í•¨í•˜ì„¸ìš”:
         * ë¹„ì ê´€ë ¨: 'ëŒ€í•œë¯¼êµ­ êµ­ë¯¼ ì¼ë°˜ ì—¬ê¶Œ ê¸°ì¤€ ì •ë³´'ì„ì„ ëª…ì‹œí•˜ê³ , 'ê´€ìš©/ì™¸êµê´€ ì—¬ê¶Œì˜ ë¹„ì ì •ë³´ëŠ” ë³„ë„ë¡œ í•´ë‹¹ ëŒ€ì‚¬ê´€ ë˜ëŠ” ê¸°ê´€ì— ì§ì ‘ ë¬¸ì˜í•´ì•¼ í•œë‹¤'ëŠ” ë‚´ìš©ì„ ë°˜ë“œì‹œ í¬í•¨í•˜ì„¸ìš”.
         * EU ì¶œì…êµ­ ì‹œìŠ¤í…œ(EES/ETIAS) ê´€ë ¨: 'ìœ ëŸ½ì—°í•©(EU)ì˜ ìƒˆë¡œìš´ ì¶œì…êµ­ ì‹œìŠ¤í…œ(EES, ETIAS ë“±)ì€ ì‹œí–‰ ì˜ˆì •ì´ë¯€ë¡œ, êµ¬ì²´ì ì¸ ì‚¬í•­ì€ ë°˜ë“œì‹œ í•´ë‹¹ êµ­ê°€ì˜ ëŒ€ì‚¬ê´€ ë˜ëŠ” ê´€ë ¨ ê¸°ê´€ì— ì§ì ‘ í™•ì¸í•´ì•¼ í•œë‹¤'ëŠ” ë‚´ìš©ì„ í¬í•¨í•˜ì„¸ìš”.
         * ì œí•œ ë¬¼í’ˆ ê´€ë ¨: 'ì œì‹œëœ ì œí•œ ë¬¼í’ˆ ì •ë³´ëŠ” ì°¸ê³  ì‚¬í•­ì´ë©°, ê°€ì¥ ì •í™•í•˜ê³  ìµœì‹  ì •ë³´ëŠ” í•´ë‹¹ í•­ê³µì‚¬, ì„¸ê´€ ë˜ëŠ” ê´€ë ¨ ê¸°ê´€ì— ì§ì ‘ í™•ì¸í•´ì•¼ í•œë‹¤'ëŠ” ë‚´ìš©ì„ ë°˜ë“œì‹œ í¬í•¨í•˜ì„¸ìš”.

    ì‚¬ìš©ì ì§ˆë¬¸: {user_query}
    ê²€ìƒ‰ëœ ì…êµ­ ì •ì±…: {retrieved_context}

    ë‹µë³€:""",

    "baggage_rule_query": """ë‹¹ì‹ ì€ ì¸ì²œêµ­ì œê³µí•­ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ì±—ë´‡ì…ë‹ˆë‹¤. ë‹¤ìŒ ìˆ˜í•˜ë¬¼ ê·œì • ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ì ì§ˆë¬¸ì— ëª…í™•í•˜ê²Œ ë‹µë³€í•´ì£¼ì„¸ìš”.
    
    ë‹¤ìŒ ì§€ì¹¨ì„ ë°˜ë“œì‹œ ë”°ë¥´ì„¸ìš”:
    1.  ì œê³µëœ 'ê²€ìƒ‰ëœ ìˆ˜í•˜ë¬¼ ê·œì •' ì •ë³´ ë‚´ì—ì„œë§Œ ë‹µë³€í•˜ì„¸ìš”. ì—†ëŠ” ì •ë³´ëŠ” ì ˆëŒ€ë¡œ ì¶”ë¡ í•˜ì—¬ ë‹µë³€í•˜ì§€ ë§ˆì„¸ìš”.
    2.  ë‹µë³€ì€ ëª…í™•í•˜ê³  ê°„ê²°í•˜ë©°, ì‚¬ìš©ì ì§ˆë¬¸ì— í•´ë‹¹í•˜ëŠ” ë‚´ìš©ì— ì§‘ì¤‘í•˜ì„¸ìš”.
    3.  ìˆ˜í•˜ë¬¼ ê·œì •ì€ 'ê¸°ë‚´ ë°˜ì…'ê³¼ 'ìœ„íƒ ìˆ˜í•˜ë¬¼'ë¡œ ë‚˜ëˆ„ì–´ ì„¤ëª…í•˜ì—¬ ì‚¬ìš©ìê°€ ì´í•´í•˜ê¸° ì‰½ë„ë¡ í•´ì£¼ì„¸ìš”.
    4.  ê²€ìƒ‰ëœ ì •ë³´ì— ì‚¬ìš©ì ì§ˆë¬¸ì— ëŒ€í•œ ë‚´ìš©ì´ ì—†ê±°ë‚˜, ë¶ˆì¶©ë¶„í•  ê²½ìš°, ë‹µë³€í•  ìˆ˜ ì—†ìŒì„ ëª…í™•íˆ ì•Œë¦¬ì„¸ìš”. (ì˜ˆ: "ì œê°€ ê°€ì§„ ì •ë³´ë¡œëŠ” í•´ë‹¹ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
    5.  íŠ¹íˆ 'ì œí•œ ë¬¼í’ˆ' ê´€ë ¨ ì •ë³´ì— ëŒ€í•œ ì§ˆë¬¸ì´ ìˆì„ ê²½ìš°, ê²€ìƒ‰ëœ ì •ë³´ì— í•´ë‹¹ ë‚´ìš©ì´ ì—†ë”ë¼ë„ ë°˜ë“œì‹œ 'ì œì‹œëœ ì œí•œ ë¬¼í’ˆ ì •ë³´ëŠ” ì°¸ê³  ì‚¬í•­ì´ë©°, ê°€ì¥ ì •í™•í•˜ê³  ìµœì‹  ì •ë³´ëŠ” í•´ë‹¹ í•­ê³µì‚¬, ì„¸ê´€ ë˜ëŠ” ê´€ë ¨ ê¸°ê´€ì— ì§ì ‘ í™•ì¸í•´ì•¼ í•œë‹¤'ëŠ” ë‚´ìš©ì„ í¬í•¨í•˜ì„¸ìš”.
    
    ì‚¬ìš©ì ì§ˆë¬¸: {user_query}
    ê²€ìƒ‰ëœ ìˆ˜í•˜ë¬¼ ê·œì •: {retrieved_context}

    ë‹µë³€:""",

    "transfer_info": """ë‹¹ì‹ ì€ ì¸ì²œêµ­ì œê³µí•­ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ì±—ë´‡ì…ë‹ˆë‹¤. ë‹¤ìŒ í™˜ìŠ¹ ì¼ë°˜ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ì ì§ˆë¬¸ì— ëª…í™•í•˜ê²Œ ë‹µë³€í•´ì£¼ì„¸ìš”.
    
    ë‹¤ìŒ ì§€ì¹¨ì„ ë°˜ë“œì‹œ ë”°ë¥´ì„¸ìš”:
    1.  ì œê³µëœ 'ê²€ìƒ‰ëœ í™˜ìŠ¹ ì •ë³´' ë‚´ì—ì„œë§Œ ë‹µë³€í•˜ì„¸ìš”. ì—†ëŠ” ì •ë³´ëŠ” ì ˆëŒ€ë¡œ ì¶”ë¡ í•˜ì—¬ ë‹µë³€í•˜ì§€ ë§ˆì„¸ìš”.
    2.  ë‹µë³€ì€ ëª…í™•í•˜ê³  ê°„ê²°í•˜ë©°, ì‚¬ìš©ì ì§ˆë¬¸ì— í•´ë‹¹í•˜ëŠ” ë‚´ìš©ì— ì§‘ì¤‘í•˜ì„¸ìš”.
    3.  í™˜ìŠ¹ ì ˆì°¨ëŠ” ê°€ëŠ¥í•œ í•œ ë‹¨ê³„ë³„ë¡œ ë‚˜ëˆ„ì–´ ì„¤ëª…í•˜ì—¬ ì‚¬ìš©ìê°€ ì´í•´í•˜ê¸° ì‰½ë„ë¡ í•´ì£¼ì„¸ìš”.
    4.  ê²€ìƒ‰ëœ ì •ë³´ì— ì‚¬ìš©ì ì§ˆë¬¸ì— ëŒ€í•œ ë‚´ìš©ì´ ì—†ê±°ë‚˜, ë¶ˆì¶©ë¶„í•  ê²½ìš°, ë‹µë³€í•  ìˆ˜ ì—†ìŒì„ ëª…í™•íˆ ì•Œë¦¬ì„¸ìš”. (ì˜ˆ: "ì œê°€ ê°€ì§„ ì •ë³´ë¡œëŠ” í•´ë‹¹ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")
    5.  í™˜ìŠ¹ ì ˆì°¨ì— ëŒ€í•œ ì§ˆë¬¸ì¼ ê²½ìš°, ì¼ë°˜ì ì¸ í™˜ìŠ¹ ì ˆì°¨(ì˜ˆ: í™˜ìŠ¹ ë³´ì•ˆ ê²€ìƒ‰, íƒ‘ìŠ¹ ê²Œì´íŠ¸ ì´ë™ ë“±)ë¥¼ êµ¬ì²´ì ìœ¼ë¡œ ì–¸ê¸‰í•´ ì£¼ì„¸ìš”.

    ì‚¬ìš©ì ì§ˆë¬¸: {user_query}
    ê²€ìƒ‰ëœ í™˜ìŠ¹ ì •ë³´: {retrieved_context}

    ë‹µë³€:""",

    "transfer_route_guide": """ë‹¹ì‹ ì€ ì¸ì²œêµ­ì œê³µí•­ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ì±—ë´‡ì…ë‹ˆë‹¤. ë‹¤ìŒ í™˜ìŠ¹ ê²½ë¡œ ë° ìµœì € í™˜ìŠ¹ ì‹œê°„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ì ì§ˆë¬¸ì— ìƒì„¸íˆ ë‹µë³€í•´ì£¼ì„¸ìš”.
    
    ë‹¤ìŒ ì§€ì¹¨ì„ ë°˜ë“œì‹œ ë”°ë¥´ì„¸ìš”:
    1.  ì œê³µëœ 'ê²€ìƒ‰ëœ í™˜ìŠ¹ ê²½ë¡œ ë° ì‹œê°„ ì •ë³´' ë‚´ì—ì„œë§Œ ë‹µë³€í•˜ì„¸ìš”. ì—†ëŠ” ì •ë³´ëŠ” ì ˆëŒ€ë¡œ ì¶”ë¡ í•˜ì—¬ ë‹µë³€í•˜ì§€ ë§ˆì„¸ìš”.
    2.  ë‹µë³€ì€ ëª…í™•í•˜ê³  ê°„ê²°í•˜ë©°, ì‚¬ìš©ì ì§ˆë¬¸ì— í•´ë‹¹í•˜ëŠ” ë‚´ìš©ì— ì§‘ì¤‘í•˜ì„¸ìš”.
    3.  í™˜ìŠ¹ ê²½ë¡œëŠ” ê°€ëŠ¥í•œ í•œ ë‹¨ê³„ë³„ë¡œ ë‚˜ëˆ„ì–´ ì„¤ëª…í•˜ì—¬ ì‚¬ìš©ìê°€ ì´í•´í•˜ê¸° ì‰½ë„ë¡ í•´ì£¼ì„¸ìš”.
    4.  íŠ¹ì • í„°ë¯¸ë„(ì˜ˆ: ì œ1ì—¬ê°í„°ë¯¸ë„, ì œ2ì—¬ê°í„°ë¯¸ë„) ê°„ì˜ ì´ë™ ì‹œê°„ì´ë‚˜ ì´ë™ ë°©ë²•ì„ êµ¬ì²´ì ìœ¼ë¡œ ì•ˆë‚´í•˜ì„¸ìš”.
    5.  ê²€ìƒ‰ëœ ì •ë³´ì— ì‚¬ìš©ì ì§ˆë¬¸ì— ëŒ€í•œ ë‚´ìš©ì´ ì—†ê±°ë‚˜, ë¶ˆì¶©ë¶„í•  ê²½ìš°, ë‹µë³€í•  ìˆ˜ ì—†ìŒì„ ëª…í™•íˆ ì•Œë¦¬ì„¸ìš”. (ì˜ˆ: "ì œê°€ ê°€ì§„ ì •ë³´ë¡œëŠ” í•´ë‹¹ í™˜ìŠ¹ ê²½ë¡œì— ëŒ€í•œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")

    ì‚¬ìš©ì ì§ˆë¬¸: {user_query}
    ê²€ìƒ‰ëœ í™˜ìŠ¹ ê²½ë¡œ ë° ì‹œê°„ ì •ë³´: {retrieved_context}

    ë‹µë³€:""",
        
    "facility_guide": """ë‹¹ì‹ ì€ ì¸ì²œêµ­ì œê³µí•­ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ì±—ë´‡ì…ë‹ˆë‹¤. ë‹¤ìŒ ê³µí•­ ì‹œì„¤ ë° ì…ì  ì—…ì²´ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ì ì§ˆë¬¸ì— ëª…í™•í•˜ê²Œ ë‹µë³€í•´ì£¼ì„¸ìš”.
    
    ë‹¤ìŒ ì§€ì¹¨ì„ ë°˜ë“œì‹œ ë”°ë¥´ì„¸ìš”:
    1.  ì œê³µëœ 'ê²€ìƒ‰ëœ ì‹œì„¤/ì—…ì²´ ì •ë³´' ë‚´ì—ì„œë§Œ ë‹µë³€í•˜ì„¸ìš”. ì—†ëŠ” ì •ë³´ëŠ” ì ˆëŒ€ë¡œ ì¶”ë¡ í•˜ì—¬ ë‹µë³€í•˜ì§€ ë§ˆì„¸ìš”.
    2.  ë‹µë³€ì€ ëª…í™•í•˜ê³  ê°„ê²°í•˜ë©°, ì‚¬ìš©ì ì§ˆë¬¸ì— í•´ë‹¹í•˜ëŠ” ë‚´ìš©ì— ì§‘ì¤‘í•˜ì„¸ìš”.
    3.  ì‹œì„¤/ì—…ì²´ì˜ ìœ„ì¹˜, ìš´ì˜ ì‹œê°„, ì£¼ìš” ì„œë¹„ìŠ¤ ë“±ì„ í¬í•¨í•˜ì—¬ êµ¬ì²´ì ìœ¼ë¡œ ì•ˆë‚´í•˜ë˜, ì œê³µëœ ì •ë³´ì— ì—†ëŠ” í•­ëª©ì€ ì–¸ê¸‰í•˜ì§€ ë§ˆì„¸ìš”.
    4.  ê²€ìƒ‰ëœ ì •ë³´ì— ì‚¬ìš©ì ì§ˆë¬¸ì— ëŒ€í•œ ë‚´ìš©ì´ ì—†ê±°ë‚˜, ë¶ˆì¶©ë¶„í•  ê²½ìš°, ë‹µë³€í•  ìˆ˜ ì—†ìŒì„ ëª…í™•íˆ ì•Œë¦¬ì„¸ìš”. (ì˜ˆ: "ì œê°€ ê°€ì§„ ì •ë³´ë¡œëŠ” í•´ë‹¹ ë‚´ìš©ì„ í™•ì¸í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")

    ì‚¬ìš©ì ì§ˆë¬¸: {user_query}
    ê²€ìƒ‰ëœ ì‹œì„¤/ì—…ì²´ ì •ë³´: {retrieved_context}

    ë‹µë³€:""",

    "airport_info": """
    ë‹¹ì‹ ì€ ì¸ì²œêµ­ì œê³µí•­ ì±—ë´‡ì…ë‹ˆë‹¤. ë‹¤ìŒ ê²€ìƒ‰ëœ ê³µí•­ ì¼ë°˜ ì •ë³´(ì½”ë“œ, ì´ë¦„, ìœ„ì¹˜ ë“±)ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ì ì§ˆë¬¸ì— ê°„ê²°í•˜ê³  ì •í™•í•˜ê²Œ ë‹µë³€í•´ì£¼ì„¸ìš”.
    
    ë‹¤ìŒ ì§€ì¹¨ì„ ë°˜ë“œì‹œ ë”°ë¥´ì„¸ìš”:
    1.  ì£¼ì–´ì§„ ì •ë³´ ë‚´ì—ì„œë§Œ ë‹µë³€í•˜ì„¸ìš”.
    2.  ê²€ìƒ‰ëœ ì •ë³´ì— ì‚¬ìš©ì ì§ˆë¬¸ì— ëŒ€í•œ ë‚´ìš©ì´ ì—†ì„ ê²½ìš°, ì§ˆë¬¸ ë‚´ìš©ì´ ì—†ê±°ë‚˜ ë‹µë³€í•  ìˆ˜ ì—†ìŒì„ ëª…í™•í•˜ê²Œ ì•Œë¦¬ì„¸ìš”. (ì˜ˆ: "ë³´ìœ í•œ ì •ë³´ì—ëŠ” í•´ë‹¹ ê³µí•­ì˜ íŠ¹ì • ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.")
    3.  ì• ë§¤ëª¨í˜¸í•˜ê±°ë‚˜ ë¶ˆí•„ìš”í•œ ì •ë³´ëŠ” ì¶”ê°€í•˜ì§€ ë§ˆì„¸ìš”.
    ì‚¬ìš©ì ì§ˆë¬¸: {user_query}
    ê²€ìƒ‰ëœ ê³µí•­ ì •ë³´: {retrieved_context}

    ë‹µë³€:""",

    # ê¸°ë³¸ í”„ë¡¬í”„íŠ¸ (ì •ì˜ë˜ì§€ ì•Šì€ ì˜ë„ë‚˜ ì˜¤ë¥˜ ì‹œ ì‚¬ìš©)
    "default": """ë‹¤ìŒ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ì ì§ˆë¬¸ì— ë‹µë³€í•´ì£¼ì„¸ìš”.
    ì‚¬ìš©ì ì§ˆë¬¸: {user_query}
    ê²€ìƒ‰ëœ ì •ë³´: {retrieved_context}

    ë‹µë³€:""",

    "flight_info": """
    ë‹¹ì‹ ì€ ì¸ì²œêµ­ì œê³µí•­ ì±—ë´‡ì…ë‹ˆë‹¤. ë‹¤ìŒ í•­ê³µí¸ ìš´í•­ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ì ì§ˆë¬¸ì— ë‹µë³€í•´ì£¼ì„¸ìš”.

    ë‹¤ìŒ ì§€ì¹¨ì„ ë°˜ë“œì‹œ ë”°ë¥´ì„¸ìš”:
    1. ì œê³µëœ 'ê²€ìƒ‰ëœ ì •ë³´' ë‚´ì—ì„œë§Œ ë‹µë³€í•˜ì„¸ìš”. ì •ë³´ê°€ ì¡´ì¬í•œë‹¤ë©´ ë°˜ë“œì‹œ ê·¸ ì •ë³´ë¥¼ í™œìš©í•˜ì—¬ ë‹µë³€í•´ì•¼ í•©ë‹ˆë‹¤.
    2. í•­ê³µí¸ëª…, í•­ê³µì‚¬, ì¶œ/ë„ì°© ê³µí•­ ì •ë³´ëŠ” ëª…í™•í•˜ê²Œ ì–¸ê¸‰í•´ì£¼ì„¸ìš”.
    3. ìš´í•­ ë‚ ì§œ ì •ë³´ê°€ ìˆë‹¤ë©´, ë‹µë³€ì— **ë°˜ë“œì‹œ** "2025ë…„ 8ì›” 12ì¼"ê³¼ ê°™ì´ ëª…í™•íˆ ì–¸ê¸‰í•´ ì£¼ì„¸ìš”.
    4. **ì¶œë°œ ì‹œê°„ ì •ë³´(`ì˜ˆì •ì‹œê°„`, `ë³€ê²½ì‹œê°„`)ë¥¼ í™•ì¸í•˜ì—¬ ë‹µë³€ì— ë°˜ë“œì‹œ í¬í•¨í•˜ì„¸ìš”. `ì˜ˆì •ì‹œê°„`ê³¼ `ë³€ê²½ì‹œê°„`ì´ ë‹¤ë¥¼ ê²½ìš° ëª¨ë‘ ì–¸ê¸‰í•˜ê³ , ë™ì¼í•  ê²½ìš° `ì¶œë°œ ì‹œê°„`ìœ¼ë¡œ í†µì¼í•˜ì—¬ ë³´ì—¬ì£¼ì„¸ìš”.**

    5. **LLMì´ ê°€ì¥ ìš°ì„ ì ìœ¼ë¡œ ê³ ë ¤í•´ì•¼ í•  í•µì‹¬ ì§€ì¹¨:**
    - ë‹¹ì‹ ì€ ì¸ì²œêµ­ì œê³µí•­ ì±—ë´‡ì…ë‹ˆë‹¤. ëª¨ë“  ë‹µë³€ì€ **ì¸ì²œêµ­ì œê³µí•­ì„ ê¸°ì¤€**ìœ¼ë¡œ ì‘ì„±í•´ì•¼ í•©ë‹ˆë‹¤.
    - ì œê³µëœ 'ê²€ìƒ‰ëœ ì •ë³´'ì˜ `direction` í•„ë“œë¥¼ í™•ì¸í•˜ì—¬, í•­ê³µí¸ì´ **ì¸ì²œê³µí•­ìœ¼ë¡œ ë„ì°©**í•˜ëŠ” í¸ì¸ì§€, **ì¸ì²œê³µí•­ì—ì„œ ì¶œë°œ**í•˜ëŠ” í¸ì¸ì§€ ì •í™•í•˜ê²Œ íŒŒì•…í•˜ê³  ë‹µë³€ì— ë°˜ì˜í•˜ì„¸ìš”.
    - `terminal` ì •ë³´ë¥¼ í™•ì¸í•˜ì—¬, `P01`ì€ **'ì œ1ì—¬ê°í„°ë¯¸ë„'**, `P03`ì€ **'ì œ2ì—¬ê°í„°ë¯¸ë„'**ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ë‹µë³€ì— í„°ë¯¸ë„ ì •ë³´ë¥¼ ë°˜ë“œì‹œ í¬í•¨í•˜ê³ , ì´ ëª…ì¹­ì„ ì •í™•íˆ ì‚¬ìš©í•˜ì„¸ìš”.

    6. ë§Œì•½ íŠ¹ì • ì •ë³´(ì˜ˆ: ê²Œì´íŠ¸, ì²´í¬ì¸ ì¹´ìš´í„°)ê°€ 'ì •ë³´ ì—†ìŒ'ìœ¼ë¡œ í‘œì‹œë˜ë©´, í•´ë‹¹ ì •ë³´ê°€ í˜„ì¬ í™•ì¸ë˜ì§€ ì•ŠìŒì„ ëª…í™•íˆ ì•Œë ¤ì£¼ì„¸ìš”.
    7. ìš´í•­ í˜„í™©(remark) ì •ë³´ê°€ ìˆì„ ê²½ìš°, ê·¸ ë‚´ìš©ì„ ê°„ê²°í•˜ê²Œ ìš”ì•½í•´ì„œ ì•Œë ¤ì£¼ì„¸ìš”.
    8. ë‹µë³€ì— ë™ì¼í•œ ì •ë³´(ì˜ˆ: íƒ‘ìŠ¹êµ¬ ë²ˆí˜¸)ë¥¼ ë°˜ë³µí•´ì„œ ì–¸ê¸‰í•˜ì§€ ë§ˆì„¸ìš”.
    9. ê²€ìƒ‰ëœ ì •ë³´ê°€ ìˆëŠ” ê²½ìš°, "ì£„ì†¡í•˜ì§€ë§Œ ìš”ì²­í•˜ì‹  ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."ì™€ ê°™ì€ ë¶€ì •ì ì¸ ë‹µë³€ì„ ì ˆëŒ€ë¡œ ìƒì„±í•˜ì§€ ë§ˆì„¸ìš”.
    10. ê²€ìƒ‰ëœ ì •ë³´ì— ì•„ë¬´ê²ƒë„ ì—†ì„ ê²½ìš°, "ì£„ì†¡í•˜ì§€ë§Œ ìš”ì²­í•˜ì‹  ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."ì™€ ê°™ì´ ëª…í™•í•˜ê²Œ ë‹µë³€í•´ ì£¼ì„¸ìš”.

    ì‚¬ìš©ì ì§ˆë¬¸: {user_query}
    ê²€ìƒ‰ëœ ì •ë³´: {retrieved_context}

    ë‹µë³€:
    """,

    "airport_congestion_prediction": """
    ë‹¹ì‹ ì€ ì¸ì²œêµ­ì œê³µí•­ ì±—ë´‡ì…ë‹ˆë‹¤. ë‹¤ìŒ ê³µí•­ í˜¼ì¡ë„ ì˜ˆì¸¡ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ì ì§ˆë¬¸ì— ë‹µë³€í•´ì£¼ì„¸ìš”.
    
    ë‹¤ìŒ ì§€ì¹¨ì„ ë°˜ë“œì‹œ ë”°ë¥´ì„¸ìš”:
    1. ì œê³µëœ 'í˜¼ì¡ë„ ì˜ˆì¸¡ ì •ë³´' ë‚´ì—ì„œë§Œ ë‹µë³€í•˜ì„¸ìš”.
    2. í„°ë¯¸ë„ ë²ˆí˜¸, ì˜ˆìƒ ìŠ¹ê° ìˆ˜, í˜¼ì¡ë„ ìˆ˜ì¤€ì„ ëª…í™•í•˜ê²Œ ì–¸ê¸‰í•´ì£¼ì„¸ìš”.
    3. 'í˜¼ì¡ë„ ìˆ˜ì¤€'ì€ 'ì›í™œ', 'ë³´í†µ', 'ë¶ë¹”', 'ë§¤ìš° ë¶ë¹”' ì¤‘ í•˜ë‚˜ë¡œë§Œ ë‹µë³€í•˜ì„¸ìš”.
    4. ì œê³µëœ ì •ë³´ì— ì‚¬ìš©ì ì§ˆë¬¸ê³¼ ê´€ë ¨ëœ ë‚´ìš©ì´ ì—†ì„ ê²½ìš°, ë‹µë³€í•  ìˆ˜ ì—†ìŒì„ ëª…í™•íˆ ì•Œë¦¬ì„¸ìš”.
    5. ë‹µë³€ ë§ˆì§€ë§‰ì—ëŠ” ë°˜ë“œì‹œ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸êµ¬ë¥¼ ì¶”ê°€í•˜ì„¸ìš”: "ì´ ì •ë³´ëŠ” ì˜ˆì¸¡ ìë£Œì´ë©°, ì‹¤ì œ ìƒí™©ê³¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìµœì‹  ì •ë³´ëŠ” ê³µí•­ ê³µì‹ ì•ˆë‚´ë¥¼ í™•ì¸í•´ ì£¼ì„¸ìš”."
    
    ì‚¬ìš©ì ì§ˆë¬¸: {user_query}
    í˜¼ì¡ë„ ì˜ˆì¸¡ ì •ë³´: {retrieved_context}
    
    ë‹µë³€:""",

    "regular_schedule_query": """
    ë‹¹ì‹ ì€ ì¸ì²œêµ­ì œê³µí•­ ì±—ë´‡ì…ë‹ˆë‹¤. ë‹¤ìŒ ì •ê¸° ìš´í•­ ìŠ¤ì¼€ì¤„ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ì ì§ˆë¬¸ì— ë‹µë³€í•´ì£¼ì„¸ìš”.

    ë‹¤ìŒ ì§€ì¹¨ì„ ë°˜ë“œì‹œ ë”°ë¥´ì„¸ìš”:
    1. ì œê³µëœ 'ê²€ìƒ‰ëœ ì •ë³´' ë‚´ì—ì„œë§Œ ë‹µë³€í•˜ì„¸ìš”. ì •ë³´ê°€ ì¡´ì¬í•œë‹¤ë©´ ë°˜ë“œì‹œ ê·¸ ì •ë³´ë¥¼ í™œìš©í•˜ì—¬ ë‹µë³€í•´ì•¼ í•©ë‹ˆë‹¤.
    2. í•­ê³µì‚¬, ëª©ì ì§€ ê³µí•­, ì¶œë°œ ì‹œê°„, ìš´í•­ ìš”ì¼, ìš´í•­ ê¸°ê°„ ì •ë³´ë¥¼ ëª…í™•í•˜ê²Œ ì–¸ê¸‰í•´ì£¼ì„¸ìš”.
    3. ëª©ì ì§€ ê³µí•­ì˜ ì½”ë“œ(ì˜ˆ: JFK)ê°€ ìˆìœ¼ë©´, í•´ë‹¹ ì½”ë“œë¥¼ í•œê¸€ ê³µí•­ëª…(ì˜ˆ: ë‰´ìš•/ì¡´ì—í”„ì¼€ë„¤ë””)ìœ¼ë¡œ ë³€í™˜í•˜ì—¬ í•¨ê»˜ ì¶œë ¥í•´ì£¼ì„¸ìš”. ë‹¨, ë„ì‹œëª…ê³¼ ê³µí•­ëª…ì´ ì¤‘ë³µë  ê²½ìš°, ê°€ì¥ ê°„ê²°í•œ í˜•íƒœë¡œ ì¶œë ¥í•´ì£¼ì„¸ìš”. (ì˜ˆ: 'ìƒŒí”„ë€ì‹œìŠ¤ì½” êµ­ì œê³µí•­' -> 'ìƒŒí”„ë€ì‹œìŠ¤ì½”')
    4. ë§Œì•½ 'schedules' ë¦¬ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆë‹¤ë©´, í•´ë‹¹ ì¡°ê±´ì— ë§ëŠ” ìŠ¤ì¼€ì¤„ì´ ì—†ìŒì„ ëª…í™•í•˜ê²Œ ì•Œë¦¬ì„¸ìš”.
    5. ìš´í•­ ìš”ì¼ ì •ë³´(monday, tuesday ë“±)ê°€ ëª¨ë‘ trueì¼ ê²½ìš°, 'ë§¤ì¼'ì´ë¼ê³  ë‹µë³€í•˜ì„¸ìš”.
    6. ë‹µë³€ ë§ˆì§€ë§‰ì—ëŠ” ë°˜ë“œì‹œ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸êµ¬ë¥¼ ì¶”ê°€í•˜ì„¸ìš”: "ì´ ì •ë³´ëŠ” ì •ê¸° ìš´í•­ ìŠ¤ì¼€ì¤„ì´ë©°, ì‹¤ì œ ìš´í•­ ì •ë³´ì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê°€ì¥ ì •í™•í•œ ì •ë³´ëŠ” í•´ë‹¹ í•­ê³µì‚¬ë‚˜ ì¸ì²œêµ­ì œê³µí•­ ê³µì‹ ì›¹ì‚¬ì´íŠ¸ì—ì„œ ì§ì ‘ í™•ì¸í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤."

    ì‚¬ìš©ì ì§ˆë¬¸: {user_query}
    ê²€ìƒ‰ëœ ì •ë³´: {retrieved_context}

    ë‹µë³€:"""
}

DISCLAIMER = (
    "\n\n"
    "ì£¼ì˜: ì´ ì •ë³´ëŠ” ì¸ì²œêµ­ì œê³µí•­ ì›¹ì‚¬ì´íŠ¸(ê³µì‹ ì¶œì²˜)ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì œê³µë˜ì§€ë§Œ, ì‹¤ì œ ê³µí•­ ìš´ì˜ ì •ë³´ì™€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤."
    "ê°€ì¥ ì •í™•í•œ ìµœì‹  ì •ë³´ëŠ” ì¸ì²œêµ­ì œê³µí•­ ê³µì‹ ì›¹ì‚¬ì´íŠ¸ ë˜ëŠ” í•´ë‹¹ í•­ê³µì‚¬/ê¸°ê´€/ì‹œì„¤ì— ì§ì ‘ í™•ì¸í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤."
)

def common_llm_rag_caller(user_query: str, retrieved_context: str, intent_description: str, intent_name: str) -> str:
    """
    ëª¨ë“  RAG í•¸ë“¤ëŸ¬ì—ì„œ ì¬ì‚¬ìš© ê°€ëŠ¥í•œ LLM í˜¸ì¶œ í•¨ìˆ˜ì…ë‹ˆë‹¤.
    ì˜ë„ë³„ ë§ì¶¤ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ì„ ì‚¬ìš©í•˜ì—¬ ë‹µë³€ì„ ìƒì„±í•©ë‹ˆë‹¤.
    """
    if not retrieved_context.strip():
        # ê²€ìƒ‰ëœ ì •ë³´ê°€ ì—†ì„ ë•Œì˜ ì‘ë‹µ
        return f"ì£„ì†¡í•©ë‹ˆë‹¤. ìš”ì²­í•˜ì‹  {intent_description} ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì§ˆë¬¸í•´ì£¼ì‹œê±°ë‚˜ ë‹¤ë¥¸ ì •ë³´ë¥¼ ë¬¸ì˜í•´ì£¼ì„¸ìš”."

    base_prompt_template = LLM_PROMPT_TEMPLATES.get(intent_name, LLM_PROMPT_TEMPLATES["default"])

    # ë³µí•© ì˜ë„ì¼ ê²½ìš° ì§ˆë¬¸ë³„ êµ¬ë¶„ ì§€ì¹¨ ì¶”ê°€
    if intent_name == "complex_intent":
        complex_intent_instruction = (
            "\n3. ì§ˆë¬¸ì´ ì—¬ëŸ¬ ê°œì¸ ê²½ìš°, ê° ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ì„ ëª…í™•íˆ êµ¬ë¶„í•˜ì—¬ ì œê³µí•˜ì„¸ìš”."
            f"\n\nì‚¬ìš©ì ì§ˆë¬¸: {user_query}"
            f"\nê²€ìƒ‰ëœ ì •ë³´: {retrieved_context}"
            f"\n\në‹µë³€:"
        )
        final_prompt = f"{base_prompt_template}{complex_intent_instruction}"
    else:
        # ë‹¨ì¼ ì˜ë„ì¼ ê²½ìš° ê¸°ì¡´ í…œí”Œë¦¿ì— ê³µí†µ ì§€ì¹¨ë§Œ ì¶”ê°€
        final_prompt = (
            f"{base_prompt_template}\n\n"
            f"ì‚¬ìš©ì ì§ˆë¬¸: {user_query}\n"
            f"ê²€ìƒ‰ëœ ì •ë³´: {retrieved_context}\n\n"
            f"ë‹µë³€:"
        )

    print("ì˜ë„ëª… :", intent_name)
    print("\n--- LLMì— ì „ì†¡ë  ìµœì¢… í”„ë¡¬í”„íŠ¸ ---")
    print(final_prompt)
    print("-----------------------------------")

    try:
        # ğŸš€ ìµœì í™”: HTML ìŠ¤íƒ€ì¼ë§ì„ í¬í•¨í•œ ë‹¨ì¼ LLM í˜¸ì¶œ

        html_system_prompt = (
            "ë‹¹ì‹ ì€ ì¸ì²œêµ­ì œê³µí•­ì˜ ì •ë³´ë¥¼ ì œê³µí•˜ëŠ” ì¹œì ˆí•˜ê³  ìœ ìš©í•œ ì±—ë´‡ì…ë‹ˆë‹¤. "
            "ë‹¤ìŒ ì§€ì¹¨ì„ ë°˜ë“œì‹œ ë”°ë¥´ì„¸ìš”:\n"
            "1. ëª¨ë“  ì‘ë‹µì€ HTML í˜•ì‹ìœ¼ë¡œ ì‘ì„±í•˜ë©°, `<p>`, `<ul>`, `<li>`, `<strong>`, `<span>` íƒœê·¸ë¥¼ ì ì ˆíˆ ì‚¬ìš©í•˜ì„¸ìš”.\n"
            "2. ë‹µë³€ì—ì„œ **ì¤‘ìš”í•œ ì •ë³´ë‚˜ í‚¤ì›Œë“œ**ëŠ” `<strong>` íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ê³ , `style=\"color: #1976D2;\"`ë¥¼ ì ìš©í•˜ì—¬ íŒŒë€ìƒ‰ìœ¼ë¡œ ê°•ì¡°í•´ì£¼ì„¸ìš”.\n"
            "3. ëª©ë¡ì„ ë‚˜ì—´í•  ë•ŒëŠ” `<ul>`ê³¼ `<li>` íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ê³ , `<li>` íƒœê·¸ì—ëŠ” ìƒ‰ìƒì„ ì ìš©í•˜ì§€ ë§ˆì„¸ìš”.\n"
            "4. ë‹µë³€ì˜ ì‹œì‘ ë¶€ë¶„ì— ì œëª©ì´ ìˆë‹¤ë©´, `<h3>` íƒœê·¸ë¥¼ ì‚¬ìš©í•˜ê³  `style=\"color: #1976D2;\"`ë¥¼ ì ìš©í•˜ì—¬ ëˆˆì— ë„ê²Œ ë§Œë“¤ì–´ì£¼ì„¸ìš”.\n"
            "5. ë‹µë³€ ë‚´ìš©ì— ì–´ìš¸ë¦¬ëŠ” ì´ëª¨ì§€ë¥¼ 1-2ê°œ í¬í•¨í•´ì„œ ë” ì¹œê·¼í•˜ê²Œ ë§Œë“¤ì–´ì£¼ì„¸ìš”.\n"
            "6. ë¶ˆí•„ìš”í•œ ì„œë‘ëŠ” ìƒëµí•˜ê³ , ë°”ë¡œ ë‹µë³€ ë³¸ë¬¸ì„ ì‹œì‘í•˜ì„¸ìš”.\n"
            "7. ê°™ì€ ì •ë³´ë¥¼ ì¤‘ë³µìœ¼ë¡œ í‘œì‹œí•˜ì§€ ë§ˆì„¸ìš”.\n"
            "8. í•­ê³µí¸ ìƒíƒœ ì •ë³´ëŠ” ì ì ˆí•œ ìƒ‰ìƒìœ¼ë¡œ í‘œì‹œí•˜ì„¸ìš” (ì¶œë°œ: #E65100, ë„ì°©: #388E3C, ì§€ì—°: #D32F2F)."
        )
        
        response = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=[
                {"role": "system", "content": html_system_prompt},
                {"role": "user", "content": final_prompt}
            ],
            temperature=0.5,
            max_tokens=700
        )
        
        styled_response = response.choices[0].message.content
        print(f"\n--- [ìµœì í™”ëœ ë‹¨ì¼ LLM ì‘ë‹µ] ---")
        print(styled_response)

        if intent_name != "complex_intent":
            styled_response += DISCLAIMER

        final_response = styled_response.replace("```html", "")
        return final_response
    
    except Exception as e:
        print(f"ë””ë²„ê·¸: LLM í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ: {e}")
        return f"ì£„ì†¡í•©ë‹ˆë‹¤. ë‹µë³€ì„ ìƒì„±í•˜ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”. (ì˜¤ë¥˜: {e})"